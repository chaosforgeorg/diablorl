register_level "poisoned_water"
{
	name    = "Poisoned Water Supply",
	depth   = 2,
	music   = 'music/dlvlc.wav',
	special = "level2",
	map     = [[
########################################################################
#####################.............######################################
####################.......................#############################
####################.......................#############################
######################....####.............#############################
####################......####.............#############################
##############..####......##############################################
##############..##..c.c.################################################
##############....................######################################
##############........c.d.........######################################
#..<.....................d......c.#############........#######..########
#...........c...........c.........#############........###=###..########
#............c................d.c...###########c.c.#......=.........####
#...........c.....#########.........###########.d.##......==........####
#######..##################...c.c...########...c.###.......====......###
#############################....................####..c.c...==...#....#
#############################..................#######.c.dc..==........#
#############################..................#######.......==........#
#############################..................########......==........#
###########################.........###################.......=..G.....#
###########################.........###################.....===.......##
###########################.........###################....d====.....###
###########################...........###################......==.====##
###########################...........###################............###
###########################...........###################........g...###
#############################.........###################............###
#############################.......#####################............###
###########################.........######################...........###
######################..g...........##########################.....#####
######################.g...........############################....#####
########################################################################
]],

	map_key = {
		['.'] = {"floor"},
		['#'] = {"stone_wall"},
		['='] = {"poisoned_river"},
		['<'] = {"stairs_up"},
		['c'] = {"floor", "carver_sword"},
		['d'] = {"floor", "dark_one_sword"},
		['g'] = {"floor", "flesh_clan"},
		['G'] = {"floor", "flesh_clan_archer"},
	},

	OnCreate = function( self )
		generator.tile_place_raw( self, self.__proto.map, self.__proto.map_key )
	end,

	OnKillAll = function(self)
		ui.play_sound("sfx/misc/questdon.wav")
		player.quest["water"] = 3
		while true do
			local c = self:find_tile("poisoned_river")
			if not c then break end
			self:set_cell(c,"river")
		end
	end
}
